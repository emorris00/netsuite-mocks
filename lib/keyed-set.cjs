const {
  Tuple
} = require("@bloomberg/record-tuple-polyfill");

// Set but with custom keying and iterable
class KeyedSet {
  #map = new Map();
  #indexes = new Map();
  #key = value => {
    return Tuple(...Array.from(this.#indexes.keys()).map(keyFunc => keyFunc(value)));
  };
  constructor(...keyFuncs) {
    keyFuncs.forEach(keyFunc => {
      this.#indexes.set(value => Tuple.from([keyFunc(value)].flat()), new Map());
    });
    return new Proxy(this, {
      get(target, prop) {
        if (prop in target) {
          return target[prop];
        } else if (Number(prop) !== NaN) {
          const arr = [...target];
          const index = Number(prop) < 0 ? arr.length - prop : prop;
          return arr[index];
        }
      }
    });
  }
  [Symbol.iterator] = () => {
    return this.#map.values();
  };
  get length() {
    return Array.from(this.#map.values()).length;
  }
  add = value => {
    if (!this.has(value)) {
      this.set(value);
    }
    return this;
  };
  set = value => {
    for (const [keyFunc, index] of this.#indexes.entries()) {
      index.set(keyFunc(value), value);
    }
    this.#map.set(this.#key(value), value);
    return this;
  };
  clear = () => {
    for (const index of this.#indexes.values()) {
      index.clear();
    }
    this.#map.clear();
  };
  delete = value => {
    let record;
    for (const [keyFunc, index] of this.#indexes.entries()) {
      record = record || index.get(keyFunc(value));
      index.delete(keyFunc(value));
    }
    return this.#map.delete(this.#key(record));
  };
  entries = () => {
    return this.#map.entries();
  };
  forEach = callback => {
    const arr = Array.from(this.#map.values());
    for (const i in arr) {
      callback(arr[i], i, arr);
    }
  };
  get = value => {
    if (this.#map.has(this.#key(value))) {
      return this.#map.get(this.#key(value));
    }
    for (const [keyFunc, index] of this.#indexes.entries()) {
      if (index.has(keyFunc(value))) {
        return index.get(keyFunc(value));
      }
    }
    return undefined;
  };
  has = value => {
    return this.get(value) !== undefined;
  };
  keys = () => {
    return this.#map.keys();
  };
  values = () => {
    return this.#map.values();
  };
}
module.exports = KeyedSet;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJUdXBsZSIsInJlcXVpcmUiLCJLZXllZFNldCIsIm1hcCIsIk1hcCIsImluZGV4ZXMiLCJrZXkiLCJ2YWx1ZSIsIkFycmF5IiwiZnJvbSIsImtleXMiLCJrZXlGdW5jIiwiY29uc3RydWN0b3IiLCJrZXlGdW5jcyIsImZvckVhY2giLCJzZXQiLCJmbGF0IiwiUHJveHkiLCJnZXQiLCJ0YXJnZXQiLCJwcm9wIiwiTnVtYmVyIiwiTmFOIiwiYXJyIiwiaW5kZXgiLCJsZW5ndGgiLCJTeW1ib2wiLCJpdGVyYXRvciIsInZhbHVlcyIsImFkZCIsImhhcyIsImVudHJpZXMiLCJjbGVhciIsImRlbGV0ZSIsInJlY29yZCIsImNhbGxiYWNrIiwiaSIsInVuZGVmaW5lZCIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyIuLi9zcmMva2V5ZWQtc2V0LmNqcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IFR1cGxlIH0gPSByZXF1aXJlKFwiQGJsb29tYmVyZy9yZWNvcmQtdHVwbGUtcG9seWZpbGxcIilcblxuLy8gU2V0IGJ1dCB3aXRoIGN1c3RvbSBrZXlpbmcgYW5kIGl0ZXJhYmxlXG5jbGFzcyBLZXllZFNldCB7XG4gICAgI21hcCA9IG5ldyBNYXAoKTtcbiAgICAjaW5kZXhlcyA9IG5ldyBNYXAoKVxuICAgICNrZXkgPSAodmFsdWUpID0+IHtcbiAgICAgICAgcmV0dXJuIFR1cGxlKC4uLkFycmF5LmZyb20odGhpcy4jaW5kZXhlcy5rZXlzKCkpLm1hcChrZXlGdW5jID0+IGtleUZ1bmModmFsdWUpKSlcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3RvciguLi5rZXlGdW5jcykge1xuICAgICAgICBrZXlGdW5jcy5mb3JFYWNoKGtleUZ1bmMgPT4ge1xuICAgICAgICAgICAgdGhpcy4jaW5kZXhlcy5zZXQoKHZhbHVlKSA9PiBUdXBsZS5mcm9tKFtrZXlGdW5jKHZhbHVlKV0uZmxhdCgpKSwgbmV3IE1hcCgpKVxuICAgICAgICB9KVxuICAgICAgICByZXR1cm4gbmV3IFByb3h5KHRoaXMsIHtcbiAgICAgICAgICAgIGdldCh0YXJnZXQsIHByb3ApIHtcbiAgICAgICAgICAgICAgICBpZihwcm9wIGluIHRhcmdldCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0W3Byb3BdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYoTnVtYmVyKHByb3ApICE9PSBOYU4pIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXJyID0gWy4uLnRhcmdldF1cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBOdW1iZXIocHJvcCkgPCAwID8gYXJyLmxlbmd0aCAtIHByb3AgOiBwcm9wXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhcnJbaW5kZXhdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBbU3ltYm9sLml0ZXJhdG9yXSA9ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuI21hcC52YWx1ZXMoKTtcbiAgICB9XG5cbiAgICBnZXQgbGVuZ3RoKCkge1xuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLiNtYXAudmFsdWVzKCkpLmxlbmd0aFxuICAgIH1cblxuICAgIGFkZCA9ICh2YWx1ZSkgPT4ge1xuICAgICAgICBpZighdGhpcy5oYXModmFsdWUpKSB7XG4gICAgICAgICAgICB0aGlzLnNldCh2YWx1ZSlcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpc1xuICAgIH1cbiAgICBzZXQgPSAodmFsdWUpID0+IHtcbiAgICAgICAgZm9yKGNvbnN0IFtrZXlGdW5jLCBpbmRleF0gb2YgdGhpcy4jaW5kZXhlcy5lbnRyaWVzKCkpIHtcbiAgICAgICAgICAgIGluZGV4LnNldChrZXlGdW5jKHZhbHVlKSwgdmFsdWUpXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4jbWFwLnNldCh0aGlzLiNrZXkodmFsdWUpLCB2YWx1ZSlcbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICB9XG4gICAgY2xlYXIgPSAoKSA9PiB7XG4gICAgICAgIGZvcihjb25zdCBpbmRleCBvZiB0aGlzLiNpbmRleGVzLnZhbHVlcygpKSB7XG4gICAgICAgICAgICBpbmRleC5jbGVhcigpXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4jbWFwLmNsZWFyKClcbiAgICB9XG4gICAgZGVsZXRlID0gKHZhbHVlKSA9PiB7XG4gICAgICAgIGxldCByZWNvcmRcbiAgICAgICAgZm9yKGNvbnN0IFtrZXlGdW5jLCBpbmRleF0gb2YgdGhpcy4jaW5kZXhlcy5lbnRyaWVzKCkpIHtcbiAgICAgICAgICAgIHJlY29yZCA9IHJlY29yZCB8fCBpbmRleC5nZXQoa2V5RnVuYyh2YWx1ZSkpXG4gICAgICAgICAgICBpbmRleC5kZWxldGUoa2V5RnVuYyh2YWx1ZSkpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuI21hcC5kZWxldGUodGhpcy4ja2V5KHJlY29yZCkpXG4gICAgfVxuICAgIGVudHJpZXMgPSAoKSA9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLiNtYXAuZW50cmllcygpXG4gICAgfVxuICAgIGZvckVhY2ggPSAoY2FsbGJhY2spID0+IHtcbiAgICAgICAgY29uc3QgYXJyID0gQXJyYXkuZnJvbSh0aGlzLiNtYXAudmFsdWVzKCkpXG4gICAgICAgIGZvcihjb25zdCBpIGluIGFycikge1xuICAgICAgICAgICAgY2FsbGJhY2soYXJyW2ldLCBpLCBhcnIpXG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0ID0gKHZhbHVlKSA9PiB7XG4gICAgICAgIGlmKHRoaXMuI21hcC5oYXModGhpcy4ja2V5KHZhbHVlKSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLiNtYXAuZ2V0KHRoaXMuI2tleSh2YWx1ZSkpXG4gICAgICAgIH1cbiAgICAgICAgZm9yKGNvbnN0IFtrZXlGdW5jLCBpbmRleF0gb2YgdGhpcy4jaW5kZXhlcy5lbnRyaWVzKCkpIHtcbiAgICAgICAgICAgIGlmKGluZGV4LmhhcyhrZXlGdW5jKHZhbHVlKSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5kZXguZ2V0KGtleUZ1bmModmFsdWUpKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICB9XG4gICAgaGFzID0gKHZhbHVlKSA9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldCh2YWx1ZSkgIT09IHVuZGVmaW5lZFxuICAgIH1cbiAgICBrZXlzID0gKCkgPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy4jbWFwLmtleXMoKVxuICAgIH1cbiAgICB2YWx1ZXMgPSAoKSA9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLiNtYXAudmFsdWVzKClcbiAgICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gS2V5ZWRTZXQiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU07RUFBRUE7QUFBTSxDQUFDLEdBQUdDLE9BQU8sQ0FBQyxrQ0FBa0MsQ0FBQzs7QUFFN0Q7QUFDQSxNQUFNQyxRQUFRLENBQUM7RUFDWCxDQUFDQyxHQUFHLEdBQUcsSUFBSUMsR0FBRyxFQUFFO0VBQ2hCLENBQUNDLE9BQU8sR0FBRyxJQUFJRCxHQUFHLEVBQUU7RUFDcEIsQ0FBQ0UsR0FBRyxHQUFJQyxLQUFLLElBQUs7SUFDZCxPQUFPUCxLQUFLLENBQUMsR0FBR1EsS0FBSyxDQUFDQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUNKLE9BQU8sQ0FBQ0ssSUFBSSxFQUFFLENBQUMsQ0FBQ1AsR0FBRyxDQUFDUSxPQUFPLElBQUlBLE9BQU8sQ0FBQ0osS0FBSyxDQUFDLENBQUMsQ0FBQztFQUNwRixDQUFDO0VBRURLLFdBQVcsQ0FBQyxHQUFHQyxRQUFRLEVBQUU7SUFDckJBLFFBQVEsQ0FBQ0MsT0FBTyxDQUFDSCxPQUFPLElBQUk7TUFDeEIsSUFBSSxDQUFDLENBQUNOLE9BQU8sQ0FBQ1UsR0FBRyxDQUFFUixLQUFLLElBQUtQLEtBQUssQ0FBQ1MsSUFBSSxDQUFDLENBQUNFLE9B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